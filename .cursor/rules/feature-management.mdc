---
description: 特性列表 (features.json) 的管理规范
globs: "**/agent-state/features.json"
alwaysApply: false
---

# Feature Management 规范

`agent-state/features.json` 是项目的特性清单，定义了所有需要实现的功能。它是 Agent 判断"项目是否完成"的唯一依据。

## Schema 定义

```json
{
  "project": "string - 项目名称",
  "description": "string - 项目高层描述",
  "created_at": "string - 创建时间 ISO 格式",
  "features": [
    {
      "id": "string - 唯一标识符，格式 F001, F002...",
      "category": "string - 分类: core | ui | api | data | auth | testing | docs | infra",
      "priority": "number - 优先级，1 为最高，数字越大越低",
      "description": "string - 特性的简要描述",
      "acceptance_criteria": ["string - 验收标准列表，每条都是可验证的具体条件"],
      "passes": "boolean - 是否已通过验证，初始为 false"
    }
  ]
}
```

## 严格规则

1. **不可删除特性**: 一旦写入 features.json 的特性条目，绝对不可以删除。删除特性会导致功能遗漏
2. **不可修改描述**: `id`, `description`, `acceptance_criteria` 字段在创建后不可修改。如果发现描述有误，在 progress.md 中记录说明，但不要修改原始定义
3. **只修改 passes 字段**: 对已有特性，唯一允许的修改是将 `passes` 从 `false` 改为 `true`
4. **不可反向修改**: 一旦 `passes` 被设为 `true`，不应该改回 `false`。如果发现已完成的特性出现回归 bug，在 progress.md 中记录并修复，但保持 `passes: true`
5. **可以添加新特性**: 如果在开发过程中发现需要新功能，可以在 features 数组末尾追加新的特性条目（使用新的 ID）
6. **优先级排序**: 实现时总是选择 `passes: false` 中 `priority` 数值最小的特性

## 特性分类指南

| 分类 | 说明 | 典型优先级 |
|------|------|-----------|
| core | 核心业务逻辑 | 1-3 |
| infra | 基础设施（构建、部署） | 1-2 |
| data | 数据模型、存储 | 2-4 |
| api | API 端点 | 3-5 |
| auth | 认证授权 | 3-5 |
| ui | 用户界面 | 4-6 |
| testing | 测试相关 | 5-7 |
| docs | 文档 | 7-9 |
